{
   "$schema": "https://vega.github.io/schema/vega/v5.json",
   "width": 300,
   "height": 200,
   "signals": [
      {
         "name": "max_x_bins",
         "value": 4,
         "description": "Max number X bins",
         "bind": {
            "input": "range",
            "min": 1,
            "max": 100,
            "step": 1
         }
      },
      {
         "name": "max_y_bins",
         "value": 4,
         "description": "Max number Y bins",
         "bind": {
            "input": "range",
            "min": 1,
            "max": 100,
            "step": 1
         }
      },
      {
         "name": "x_name",
         "value": "test4"
      },
      {
         "name": "y_name",
         "value": "test5"
      }
   ],
   "data": [
      {
         "name": "points",
         "values": [
            {
               "test4": 0.8664690649697527,
               "test5": 1.5904874380883884
            },
            {
               "test4": 0.8417930930764828,
               "test5": 2.9777028085512462
            },
            {
               "test4": 0.6447880037231447,
               "test5": 2.950058754720282
            },
            {
               "test4": 2.9830295409679026,
               "test5": 1.4873242948167902
            },
            {
               "test4": 0.7042135110583099,
               "test5": 0.5932692204227227
            },
            {
               "test4": 1.8308997125279447,
               "test5": 0.21045082466236786
            },
            {
               "test4": 0.29298422286806913,
               "test5": 2.158580855815317
            },
            {
               "test4": 1.4102739299105793,
               "test5": 0.12303675677019665
            },
            {
               "test4": 2.6934663789048754,
               "test5": 1.721535084043977
            },
            {
               "test4": 1.139441404140149,
               "test5": 0.8418447965784163
            },
            {
               "test4": 0.21939037403444983,
               "test5": 0.25647187252168624
            },
            {
               "test4": 1.2631490212169985,
               "test5": 2.148905916439709
            },
            {
               "test4": 1.8990718022982414,
               "test5": 1.9537965840818623
            },
            {
               "test4": 0.6451760204002314,
               "test5": 2.0518088681438487
            },
            {
               "test4": 1.0696506825351544,
               "test5": 2.1451775315108783
            },
            {
               "test4": 0.12657025014148138,
               "test5": 2.171567568074236
            },
            {
               "test4": 2.827895989607024,
               "test5": 0.7863795817343414
            },
            {
               "test4": 1.1260055133645248,
               "test5": 0.016524908376419623
            },
            {
               "test4": 1.7589619037538036,
               "test5": 2.81338905156131
            },
            {
               "test4": 1.3392781731072096,
               "test5": 1.7113399911869784
            },
            {
               "test4": 0.4255432159086677,
               "test5": 1.2176877474633852
            },
            {
               "test4": 2.7300370272020023,
               "test5": 0.34348235350382816
            },
            {
               "test4": 0.5915086415695461,
               "test5": 0.6712333550927022
            },
            {
               "test4": 1.6924575918568017,
               "test5": 2.7020618540620776
            },
            {
               "test4": 0.8029054352549942,
               "test5": 2.6377859761354268
            },
            {
               "test4": 1.072520970588048,
               "test5": 2.4390578166680887
            },
            {
               "test4": 0.5288782761218727,
               "test5": 1.2230124495913597
            },
            {
               "test4": 0.9923028814560114,
               "test5": 1.4174976674489583
            },
            {
               "test4": 1.0918838551356023,
               "test5": 0.8127975171827653
            },
            {
               "test4": 0.5786135606034594,
               "test5": 2.4990160850979555
            },
            {
               "test4": 1.3711546130802557,
               "test5": 2.28411005295217
            },
            {
               "test4": 0.8181102649458958,
               "test5": 2.615869728647389
            },
            {
               "test4": 2.9224201584143774,
               "test5": 2.2065367556172975
            },
            {
               "test4": 1.3654703189266224,
               "test5": 1.7811547453726932
            },
            {
               "test4": 2.7488585186542425,
               "test5": 1.2532224203982123
            },
            {
               "test4": 0.601922783664491,
               "test5": 2.681902161449168
            },
            {
               "test4": 0.666840803902546,
               "test5": 0.606216069482281
            },
            {
               "test4": 0.7907624309570326,
               "test5": 2.041295861134346
            },
            {
               "test4": 1.2907319036497864,
               "test5": 2.2705699314656353
            },
            {
               "test4": 0.6401057504441613,
               "test5": 2.891080318355459
            },
            {
               "test4": 1.8727673254859756,
               "test5": 2.6953823782034014
            },
            {
               "test4": 0.4219682694731175,
               "test5": 0.9175087657354574
            },
            {
               "test4": 0.8228271947454912,
               "test5": 1.9483504208937967
            },
            {
               "test4": 2.884733055055867,
               "test5": 0.7527188776836543
            },
            {
               "test4": 1.1231262592915248,
               "test5": 0.2803625404814867
            },
            {
               "test4": 2.6850595241616366,
               "test5": 2.7265930739433517
            },
            {
               "test4": 0.13960616858046704,
               "test5": 0.5184963731080634
            },
            {
               "test4": 2.8657427245068954,
               "test5": 2.432886859683083
            },
            {
               "test4": 2.242616451191,
               "test5": 2.2563977839198897
            },
            {
               "test4": 0.9684684671289207,
               "test5": 0.8651676350713489
            },
            {
               "test4": 1.3601364122612623,
               "test5": 0.1704207637176921
            },
            {
               "test4": 2.823669203381043,
               "test5": 1.4217876123553619
            },
            {
               "test4": 0.7733972100971084,
               "test5": 1.1211745866693892
            },
            {
               "test4": 2.916678439902519,
               "test5": 2.8668379063334815
            },
            {
               "test4": 0.4607256203559976,
               "test5": 1.3235870213559853
            },
            {
               "test4": 1.137023013604243,
               "test5": 2.576978789690692
            },
            {
               "test4": 1.9813004105420897,
               "test5": 1.009258294392007
            },
            {
               "test4": 2.585664809186132,
               "test5": 2.2915156567254567
            },
            {
               "test4": 2.9468017321072644,
               "test5": 2.9929302736327106
            },
            {
               "test4": 0.07845593781827775,
               "test5": 2.203752992433253
            },
            {
               "test4": 1.3835405625605182,
               "test5": 2.6991662968510957
            },
            {
               "test4": 0.5890051457876584,
               "test5": 0.22930444055172605
            },
            {
               "test4": 1.2204475279014333,
               "test5": 0.9658748777808576
            },
            {
               "test4": 2.116320019096803,
               "test5": 2.894847148200067
            },
            {
               "test4": 2.8951136642314252,
               "test5": 1.8590284521984382
            },
            {
               "test4": 0.9888209776631802,
               "test5": 0.3941585453067681
            },
            {
               "test4": 1.476918151959207,
               "test5": 2.1364763288624693
            },
            {
               "test4": 1.9188269305558705,
               "test5": 1.6821780779853541
            },
            {
               "test4": 0.04987967353511058,
               "test5": 2.4836542103570456
            },
            {
               "test4": 2.1973326126194546,
               "test5": 2.1524586694198273
            },
            {
               "test4": 2.121799257738498,
               "test5": 2.2945347490499537
            },
            {
               "test4": 1.5507280783152884,
               "test5": 2.238331688324412
            },
            {
               "test4": 1.5725791398030533,
               "test5": 2.6636856715851414
            },
            {
               "test4": 1.3633224842976266,
               "test5": 1.6089657264775368
            },
            {
               "test4": 2.328533969618821,
               "test5": 2.4750389478778487
            },
            {
               "test4": 2.5530340053609137,
               "test5": 1.0748839869176816
            },
            {
               "test4": 1.055201588977492,
               "test5": 0.3058125568312301
            },
            {
               "test4": 2.860549576905471,
               "test5": 2.6112489855771024
            },
            {
               "test4": 0.7195448832680549,
               "test5": 1.3157676103326956
            },
            {
               "test4": 0.24888599577548254,
               "test5": 1.7879187908760579
            },
            {
               "test4": 1.4209233387618632,
               "test5": 0.6277783127314884
            },
            {
               "test4": 0.7618431883636191,
               "test5": 1.9550288054466411
            },
            {
               "test4": 0.9246303682721094,
               "test5": 1.5114954481664191
            },
            {
               "test4": 2.50993800121491,
               "test5": 0.8644354573503296
            },
            {
               "test4": 2.336412903513777,
               "test5": 0.7261635015404846
            },
            {
               "test4": 0.6690445997395971,
               "test5": 2.6225764813983
            },
            {
               "test4": 0.006351485364444076,
               "test5": 2.1626843335930412
            },
            {
               "test4": 0.7349136306056752,
               "test5": 1.520749470549845
            },
            {
               "test4": 1.8272129710397325,
               "test5": 2.425985564546404
            },
            {
               "test4": 0.727212253489813,
               "test5": 1.4835530513313624
            },
            {
               "test4": 1.2603681658084216,
               "test5": 1.3282538668871293
            },
            {
               "test4": 2.3432852065058327,
               "test5": 0.29575135504584626
            },
            {
               "test4": 0.07341001487980703,
               "test5": 0.2208771764178008
            },
            {
               "test4": 2.0976110704044424,
               "test5": 2.0587084091772674
            },
            {
               "test4": 2.2151583121531324,
               "test5": 0.8108624830953617
            },
            {
               "test4": 0.8152396734771623,
               "test5": 1.39325250958832
            },
            {
               "test4": 2.9097883282349812,
               "test5": 0.8747325698124992
            },
            {
               "test4": 2.233425043800268,
               "test5": 2.6341093289106663
            },
            {
               "test4": 2.3217069871677607,
               "test5": 1.1310924443839587
            },
            {
               "test4": 0.8371531182134472,
               "test5": 2.0519266314801885
            }
         ]
      },
      {
         "name": "heatmap_bins",
         "source": "points",
         "transform": [
            {
               "type": "extent",
               "field": {
                  "signal": "x_name"
               },
               "signal": "x_extent"
            },
            {
               "type": "bin",
               "field": {
                  "signal": "x_name"
               },
               "as": [
                  "x_start",
                  "x_end"
               ],
               "signal": "x_bins",
               "extent": {
                  "signal": "x_extent"
               },
               "maxbins": {
                  "signal": "max_x_bins"
               }
            },
            {
               "type": "extent",
               "field": {
                  "signal": "y_name"
               },
               "signal": "y_extent"
            },
            {
               "type": "bin",
               "field": {
                  "signal": "y_name"
               },
               "as": [
                  "y_start",
                  "y_end"
               ],
               "signal": "y_bins",
               "extent": {
                  "signal": "y_extent"
               },
               "maxbins": {
                  "signal": "max_y_bins"
               }
            },
            {
               "type": "aggregate",
               "groupby": [
                  "x_start",
                  "x_end",
                  "y_start",
                  "y_end"
               ],
               "ops": [
                  "count"
               ],
               "as": [
                  "__count"
               ]
            }
         ]
      }
   ],
   "marks": [
      {
         "name": "marks",
         "type": "rect",
         "style": [
            "rect"
         ],
         "from": {
            "data": "heatmap_bins"
         },
         "encode": {
            "update": {
               "fill": {
                  "scale": "color",
                  "field": "__count"
               },
               "x2": {
                  "scale": "x",
                  "field": "x_start"
               },
               "x": {
                  "scale": "x",
                  "field": "x_end"
               },
               "y2": {
                  "scale": "y",
                  "field": "y_start"
               },
               "y": {
                  "scale": "y",
                  "field": "y_end"
               }
            }
         }
      },
      {
         "type": "symbol",
         "from": {
            "data": "points"
         },
         "encode": {
            "enter": {
               "fillOpacity": {
                  "value": 1
               },
               "fill": {
                  "value": "black"
               }
            },
            "update": {
               "x": {
                  "scale": "x",
                  "field": {
                     "signal": "x_name"
                  }
               },
               "y": {
                  "scale": "y",
                  "field": {
                     "signal": "y_name"
                  }
               },
               "size": {
                  "value": 10
               }
            }
         }
      }
   ],
   "scales": [
      {
         "name": "x",
         "type": "linear",
         "domain": {
            "signal": "[x_bins.start, x_bins.stop]"
         },
         "range": [
            0,
            {
               "signal": "width"
            }
         ],
         "bins": {
            "signal": "x_bins"
         },
         "zero": false
      },
      {
         "name": "y",
         "type": "linear",
         "domain": {
            "signal": "[y_bins.start, y_bins.stop]"
         },
         "range": [
            {
               "signal": "height"
            },
            0
         ],
         "bins": {
            "signal": "y_bins"
         },
         "zero": false
      },
      {
         "name": "color",
         "type": "linear",
         "domain": {
            "data": "heatmap_bins",
            "field": "__count"
         },
         "range": "heatmap",
         "interpolate": "hcl",
         "zero": true
      }
   ],
   "axes": [
      {
         "scale": "x",
         "orient": "bottom",
         "title": {
            "signal": "x_name"
         },
         "labelOverlap": true,
         "tickCount": {
            "signal": "ceil(width/3)"
         }
      },
      {
         "scale": "y",
         "orient": "left",
         "title": {
            "signal": "y_name"
         },
         "labelOverlap": true,
         "tickCount": {
            "signal": "ceil(height/3)"
         }
      }
   ],
   "legends": [
      {
         "fill": "color",
         "gradientLength": {
            "signal": "height - 16"
         },
         "title": "Count of Records"
      }
   ]
}