{
   "$schema": "https://vega.github.io/schema/vega/v5.json",
   "width": 300,
   "height": 200,
   "signals": [
      {
         "name": "max_x_bins",
         "value": 4,
         "description": "Max number X bins",
         "bind": {
            "input": "range",
            "min": 1,
            "max": 100,
            "step": 1
         }
      },
      {
         "name": "max_y_bins",
         "value": 4,
         "description": "Max number Y bins",
         "bind": {
            "input": "range",
            "min": 1,
            "max": 100,
            "step": 1
         }
      },
      {
         "name": "x_name",
         "value": "test4"
      },
      {
         "name": "y_name",
         "value": "test5"
      }
   ],
   "data": [
      {
         "name": "points",
         "values": [
            {
               "test4": 2.313961929800238,
               "test5": 0.0622558480782045
            },
            {
               "test4": 1.9009447047788264,
               "test5": 2.246411647615836
            },
            {
               "test4": 1.4955210369077712,
               "test5": 0.674389936592543
            },
            {
               "test4": 0.5941885942788719,
               "test5": 2.2815921365968763
            },
            {
               "test4": 0.5073325096876063,
               "test5": 0.2650194425220308
            },
            {
               "test4": 2.056079455103392,
               "test5": 2.8601800385848097
            },
            {
               "test4": 0.011844798983743354,
               "test5": 1.53657679015733
            },
            {
               "test4": 2.4378628849563406,
               "test5": 1.8375782004881644
            },
            {
               "test4": 2.1652659522953988,
               "test5": 0.8756282045118995
            },
            {
               "test4": 2.7533223675388303,
               "test5": 2.1437273501930716
            },
            {
               "test4": 1.6276331040337837,
               "test5": 0.4265101428045809
            },
            {
               "test4": 1.1200222801544077,
               "test5": 2.022400845199036
            },
            {
               "test4": 1.3254995232689883,
               "test5": 1.3020419799998812
            },
            {
               "test4": 1.8533009354079515,
               "test5": 1.5394147276631727
            },
            {
               "test4": 1.9511915457944018,
               "test5": 1.8031168602136332
            },
            {
               "test4": 2.4156695904982395,
               "test5": 1.5649414571809024
            },
            {
               "test4": 2.725946642426005,
               "test5": 0.9577082669656358
            },
            {
               "test4": 0.2713780478127221,
               "test5": 0.9021001699086101
            },
            {
               "test4": 0.3419530855906493,
               "test5": 2.48604397892303
            },
            {
               "test4": 0.1406889581677493,
               "test5": 1.8788614449341776
            },
            {
               "test4": 1.6427584677577305,
               "test5": 2.457860987010206
            },
            {
               "test4": 0.5968426190364369,
               "test5": 2.5705509073731996
            },
            {
               "test4": 1.0549579182962638,
               "test5": 2.2639430745895717
            },
            {
               "test4": 0.8878851206390361,
               "test5": 2.651809438683559
            },
            {
               "test4": 0.9765349134967464,
               "test5": 0.49504769315744546
            },
            {
               "test4": 1.1775877318397618,
               "test5": 0.2803811236759509
            },
            {
               "test4": 2.4633169735107856,
               "test5": 0.4534560589276916
            },
            {
               "test4": 1.1523433460765986,
               "test5": 2.8327821367164034
            },
            {
               "test4": 2.962876424705617,
               "test5": 1.3689136412843523
            },
            {
               "test4": 2.4783685315282193,
               "test5": 0.754122402621178
            },
            {
               "test4": 1.7921149446926528,
               "test5": 2.708495280994882
            },
            {
               "test4": 1.6036738464054452,
               "test5": 1.7706040889562686
            },
            {
               "test4": 0.11784530167616203,
               "test5": 1.0715452759036088
            },
            {
               "test4": 0.23883927046789255,
               "test5": 0.9163797550284548
            },
            {
               "test4": 0.992157935946396,
               "test5": 2.3214908886317875
            },
            {
               "test4": 0.1198776260699318,
               "test5": 1.288476535294915
            },
            {
               "test4": 0.9447806155280649,
               "test5": 1.9094734292026339
            },
            {
               "test4": 1.039041450240099,
               "test5": 0.12929206861498332
            },
            {
               "test4": 2.639745523553748,
               "test5": 2.2897217614310432
            },
            {
               "test4": 2.634289928174575,
               "test5": 1.2525274315178008
            },
            {
               "test4": 1.8167326931812702,
               "test5": 1.5403998822248652
            },
            {
               "test4": 1.793509943888921,
               "test5": 0.7866469833958508
            },
            {
               "test4": 0.9026139268221217,
               "test5": 0.0761993461503182
            },
            {
               "test4": 0.9091876819531043,
               "test5": 0.7262276262105821
            },
            {
               "test4": 1.6727345659879327,
               "test5": 1.6965210596645026
            },
            {
               "test4": 1.4253967422451517,
               "test5": 0.8783939288685273
            },
            {
               "test4": 0.19275318208447334,
               "test5": 2.936457437272928
            },
            {
               "test4": 1.0191235309135909,
               "test5": 1.4851458926473629
            },
            {
               "test4": 2.9312421777680453,
               "test5": 1.3223214747019996
            },
            {
               "test4": 0.9548184164368536,
               "test5": 1.5593909576261404
            },
            {
               "test4": 1.7344092896474024,
               "test5": 2.561801251501459
            },
            {
               "test4": 0.2042918206138501,
               "test5": 1.3935924233379975
            },
            {
               "test4": 2.3458473558574453,
               "test5": 2.1558084311467507
            },
            {
               "test4": 1.7580659401595276,
               "test5": 0.11128323970322362
            },
            {
               "test4": 1.051969173849399,
               "test5": 1.689572053478235
            },
            {
               "test4": 0.8991896172736885,
               "test5": 1.5370024598206478
            },
            {
               "test4": 2.020400775854162,
               "test5": 0.4775812001342805
            },
            {
               "test4": 0.15143301046199287,
               "test5": 1.0134476611940384
            },
            {
               "test4": 0.3241913183383577,
               "test5": 0.5367084257132713
            },
            {
               "test4": 2.657481288503117,
               "test5": 1.0960949136423475
            },
            {
               "test4": 0.6563080475386102,
               "test5": 2.2574885106558087
            },
            {
               "test4": 0.32063875318070745,
               "test5": 2.233809722326682
            },
            {
               "test4": 1.4093558803214834,
               "test5": 1.7947670138373275
            },
            {
               "test4": 0.442860576855893,
               "test5": 0.5521044662794538
            },
            {
               "test4": 1.9352163794047255,
               "test5": 0.14588401879021673
            },
            {
               "test4": 0.7458375234083083,
               "test5": 1.6272255486840126
            },
            {
               "test4": 0.6803200298100276,
               "test5": 1.1442346047138963
            },
            {
               "test4": 2.766698360710639,
               "test5": 2.77607061860333
            },
            {
               "test4": 1.700249773725,
               "test5": 1.600412654967008
            },
            {
               "test4": 0.044580073899684325,
               "test5": 2.933697790206015
            },
            {
               "test4": 1.7190867120995574,
               "test5": 2.3752709888298718
            },
            {
               "test4": 1.684672080829107,
               "test5": 2.632005724694804
            },
            {
               "test4": 1.7525874855920267,
               "test5": 2.1265494791068655
            },
            {
               "test4": 0.4456003540693757,
               "test5": 1.2853522169036893
            },
            {
               "test4": 2.081670199027235,
               "test5": 0.3138592335685595
            },
            {
               "test4": 1.3188157133237715,
               "test5": 0.49860644311360103
            },
            {
               "test4": 1.5209358877921422,
               "test5": 2.4571075924086374
            },
            {
               "test4": 0.2703202041733156,
               "test5": 2.4002062520824357
            },
            {
               "test4": 1.6953790618734135,
               "test5": 1.7680431350418222
            },
            {
               "test4": 0.5943019716488067,
               "test5": 1.308354766016503
            },
            {
               "test4": 0.8877112866625121,
               "test5": 0.11267302782503308
            },
            {
               "test4": 0.09205452111883883,
               "test5": 1.3593150006037003
            },
            {
               "test4": 2.234592230850203,
               "test5": 1.671886218709191
            },
            {
               "test4": 1.1553407986964594,
               "test5": 0.5042183925978558
            },
            {
               "test4": 2.5147839621110784,
               "test5": 1.7971553923844779
            },
            {
               "test4": 2.3481444547349133,
               "test5": 2.545527545684144
            },
            {
               "test4": 1.8094889275861044,
               "test5": 2.3431818518708463
            },
            {
               "test4": 1.847210628100708,
               "test5": 0.06349557351646495
            },
            {
               "test4": 2.2513938314624733,
               "test5": 0.5281263998510817
            },
            {
               "test4": 1.375542618711819,
               "test5": 1.5393681231967353
            },
            {
               "test4": 1.4520626708604776,
               "test5": 2.5331573836180428
            },
            {
               "test4": 0.5244416844663582,
               "test5": 0.0439046253097497
            },
            {
               "test4": 2.5462922154336964,
               "test5": 2.2280237318983023
            },
            {
               "test4": 1.3700926059605165,
               "test5": 1.2506952211481333
            },
            {
               "test4": 0.3501885328408898,
               "test5": 1.0160373989680191
            },
            {
               "test4": 0.28397712223095917,
               "test5": 2.1474926182539424
            },
            {
               "test4": 0.23125621324811585,
               "test5": 0.6178507751069175
            },
            {
               "test4": 1.7213286943536064,
               "test5": 0.8814946656113041
            },
            {
               "test4": 1.9671802281437945,
               "test5": 2.410705043229659
            },
            {
               "test4": 1.0536405089892262,
               "test5": 0.28032113083130117
            }
         ]
      },
      {
         "name": "heatmap_bins",
         "source": "points",
         "transform": [
            {
               "type": "extent",
               "field": {
                  "signal": "x_name"
               },
               "signal": "x_extent"
            },
            {
               "type": "bin",
               "field": {
                  "signal": "x_name"
               },
               "as": [
                  "x_start",
                  "x_end"
               ],
               "signal": "x_bins",
               "extent": {
                  "signal": "x_extent"
               },
               "maxbins": {
                  "signal": "max_x_bins"
               }
            },
            {
               "type": "extent",
               "field": {
                  "signal": "y_name"
               },
               "signal": "y_extent"
            },
            {
               "type": "bin",
               "field": {
                  "signal": "y_name"
               },
               "as": [
                  "y_start",
                  "y_end"
               ],
               "signal": "y_bins",
               "extent": {
                  "signal": "y_extent"
               },
               "maxbins": {
                  "signal": "max_y_bins"
               }
            },
            {
               "type": "aggregate",
               "groupby": [
                  "x_start",
                  "x_end",
                  "y_start",
                  "y_end"
               ],
               "ops": [
                  "count"
               ],
               "as": [
                  "__count"
               ]
            }
         ]
      }
   ],
   "marks": [
      {
         "name": "marks",
         "type": "rect",
         "style": [
            "rect"
         ],
         "from": {
            "data": "heatmap_bins"
         },
         "encode": {
            "update": {
               "fill": {
                  "scale": "color",
                  "field": "__count"
               },
               "x2": {
                  "scale": "x",
                  "field": "x_start"
               },
               "x": {
                  "scale": "x",
                  "field": "x_end"
               },
               "y2": {
                  "scale": "y",
                  "field": "y_start"
               },
               "y": {
                  "scale": "y",
                  "field": "y_end"
               }
            }
         }
      },
      {
         "type": "symbol",
         "from": {
            "data": "points"
         },
         "encode": {
            "enter": {
               "fillOpacity": {
                  "value": 1
               },
               "fill": {
                  "value": "black"
               }
            },
            "update": {
               "x": {
                  "scale": "x",
                  "field": {
                     "signal": "x_name"
                  }
               },
               "y": {
                  "scale": "y",
                  "field": {
                     "signal": "y_name"
                  }
               },
               "size": {
                  "value": 10
               }
            }
         }
      }
   ],
   "scales": [
      {
         "name": "x",
         "type": "linear",
         "domain": {
            "signal": "[x_bins.start, x_bins.stop]"
         },
         "range": [
            0,
            {
               "signal": "width"
            }
         ],
         "bins": {
            "signal": "x_bins"
         },
         "zero": false
      },
      {
         "name": "y",
         "type": "linear",
         "domain": {
            "signal": "[y_bins.start, y_bins.stop]"
         },
         "range": [
            {
               "signal": "height"
            },
            0
         ],
         "bins": {
            "signal": "y_bins"
         },
         "zero": false
      },
      {
         "name": "color",
         "type": "linear",
         "domain": {
            "data": "heatmap_bins",
            "field": "__count"
         },
         "range": "heatmap",
         "interpolate": "hcl",
         "zero": true
      }
   ],
   "axes": [
      {
         "scale": "x",
         "orient": "bottom",
         "title": {
            "signal": "x_name"
         },
         "labelOverlap": true,
         "tickCount": {
            "signal": "ceil(width/3)"
         }
      },
      {
         "scale": "y",
         "orient": "left",
         "title": {
            "signal": "y_name"
         },
         "labelOverlap": true,
         "tickCount": {
            "signal": "ceil(height/3)"
         }
      }
   ],
   "legends": [
      {
         "fill": "color",
         "gradientLength": {
            "signal": "height - 16"
         },
         "title": "Count of Records"
      }
   ]
}