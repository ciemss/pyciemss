{
   "$schema": "https://vega.github.io/schema/vega/v5.json",
   "width": 300,
   "height": 200,
   "signals": [
      {
         "name": "max_x_bins",
         "value": 4,
         "description": "Max number X bins",
         "bind": {
            "input": "range",
            "min": 1,
            "max": 100,
            "step": 1
         }
      },
      {
         "name": "max_y_bins",
         "value": 4,
         "description": "Max number Y bins",
         "bind": {
            "input": "range",
            "min": 1,
            "max": 100,
            "step": 1
         }
      },
      {
         "name": "x_name",
         "value": "test4"
      },
      {
         "name": "y_name",
         "value": "test5"
      }
   ],
   "data": [
      {
         "name": "points",
         "values": [
            {
               "test4": 0.2626990123192159,
               "test5": 2.9742972990704155
            },
            {
               "test4": 1.0096988928486867,
               "test5": 1.2658842614039796
            },
            {
               "test4": 0.7314940091836191,
               "test5": 2.470836355090076
            },
            {
               "test4": 2.1869020431227395,
               "test5": 0.9301689671779407
            },
            {
               "test4": 1.0648366257128399,
               "test5": 1.5079105309341871
            },
            {
               "test4": 0.718565629814588,
               "test5": 1.2847605736550332
            },
            {
               "test4": 0.9028912694884584,
               "test5": 2.395363221281819
            },
            {
               "test4": 0.3873553257473761,
               "test5": 1.6118055147477137
            },
            {
               "test4": 0.6023388801320688,
               "test5": 1.924751561548244
            },
            {
               "test4": 1.1759147043474314,
               "test5": 2.656210811517826
            },
            {
               "test4": 1.8573340911793625,
               "test5": 0.6106572421268979
            },
            {
               "test4": 1.0053590666802732,
               "test5": 0.23811339655151686
            },
            {
               "test4": 1.9248974317239786,
               "test5": 2.6833583988368157
            },
            {
               "test4": 2.598031248080798,
               "test5": 1.3049316019013266
            },
            {
               "test4": 2.07439777510462,
               "test5": 0.906011607996344
            },
            {
               "test4": 1.5577027592497958,
               "test5": 0.4483173578531797
            },
            {
               "test4": 2.2159456506847124,
               "test5": 0.9867067341114251
            },
            {
               "test4": 1.584992947979441,
               "test5": 2.9008347543837534
            },
            {
               "test4": 2.2717863161106773,
               "test5": 2.075621441066494
            },
            {
               "test4": 0.8671532758469185,
               "test5": 1.2556737472864832
            },
            {
               "test4": 2.1463935326951233,
               "test5": 1.3064996180723436
            },
            {
               "test4": 1.3049231949283082,
               "test5": 2.952425882696291
            },
            {
               "test4": 1.2112584930667891,
               "test5": 1.1030661552497174
            },
            {
               "test4": 0.4261730285108529,
               "test5": 0.15118072770964974
            },
            {
               "test4": 1.173280053145043,
               "test5": 0.8000689441170709
            },
            {
               "test4": 1.1533648391332147,
               "test5": 1.5362159609807664
            },
            {
               "test4": 0.3682120636848285,
               "test5": 1.754176805145728
            },
            {
               "test4": 0.7338217996251248,
               "test5": 0.7834644357190761
            },
            {
               "test4": 1.0198331485052723,
               "test5": 2.0635878033419277
            },
            {
               "test4": 0.3822388723591331,
               "test5": 1.5570917402055047
            },
            {
               "test4": 2.377936616196374,
               "test5": 2.8958549767204858
            },
            {
               "test4": 0.597971474559962,
               "test5": 0.2941712414116662
            },
            {
               "test4": 0.46036999297926806,
               "test5": 0.7611113752409986
            },
            {
               "test4": 2.1397705292488096,
               "test5": 2.543696845558604
            },
            {
               "test4": 2.761180425840458,
               "test5": 0.336440721918269
            },
            {
               "test4": 1.9780970213789828,
               "test5": 2.133646525064064
            },
            {
               "test4": 2.947050693904246,
               "test5": 0.6467532260063634
            },
            {
               "test4": 0.30075624640784815,
               "test5": 2.0723978055970727
            },
            {
               "test4": 2.6862017807425222,
               "test5": 2.76167246733414
            },
            {
               "test4": 2.814530612044944,
               "test5": 2.761087505983542
            },
            {
               "test4": 2.719190352154324,
               "test5": 2.9126735002543516
            },
            {
               "test4": 0.8436021450221869,
               "test5": 2.5929365225323937
            },
            {
               "test4": 1.7673730088774355,
               "test5": 2.558050420432216
            },
            {
               "test4": 1.6223706498107435,
               "test5": 2.3695187944547538
            },
            {
               "test4": 0.07909107186028874,
               "test5": 2.1445370660291987
            },
            {
               "test4": 1.4861316007945466,
               "test5": 0.7831491431212341
            },
            {
               "test4": 0.21896526649747072,
               "test5": 2.780497559679867
            },
            {
               "test4": 1.4126968093345151,
               "test5": 0.4091784827217221
            },
            {
               "test4": 1.3441219666715871,
               "test5": 1.5897549235562052
            },
            {
               "test4": 0.7729002667438132,
               "test5": 1.1373255292934505
            },
            {
               "test4": 0.8629541271988582,
               "test5": 1.4473452936457778
            },
            {
               "test4": 1.4643358356374774,
               "test5": 1.2481323165572422
            },
            {
               "test4": 1.12946400938677,
               "test5": 2.983130344337011
            },
            {
               "test4": 0.7349877816727107,
               "test5": 2.199227339434059
            },
            {
               "test4": 1.4486816559085502,
               "test5": 2.10761587797421
            },
            {
               "test4": 0.010184042172960761,
               "test5": 0.9813188504050561
            },
            {
               "test4": 2.9934892325784865,
               "test5": 2.568090378816884
            },
            {
               "test4": 1.6122962081069456,
               "test5": 0.41977331660382344
            },
            {
               "test4": 2.1257508734677626,
               "test5": 1.6081293521007063
            },
            {
               "test4": 1.9352580302411937,
               "test5": 0.6114646208002694
            },
            {
               "test4": 2.427333718146241,
               "test5": 2.3885068558588327
            },
            {
               "test4": 2.317149186768294,
               "test5": 0.7244447100586988
            },
            {
               "test4": 1.6701834224147554,
               "test5": 1.8776881042311726
            },
            {
               "test4": 1.0102904654421228,
               "test5": 1.0447146660974427
            },
            {
               "test4": 0.7086082621827535,
               "test5": 0.39287278531189196
            },
            {
               "test4": 2.1302819397880377,
               "test5": 1.1737853530355795
            },
            {
               "test4": 2.948552825011216,
               "test5": 1.0480700187674772
            },
            {
               "test4": 1.2418703498384422,
               "test5": 2.985615571886619
            },
            {
               "test4": 0.4962424885646476,
               "test5": 1.5903577587535
            },
            {
               "test4": 2.16444984884102,
               "test5": 0.7716832013991586
            },
            {
               "test4": 1.2371914995527142,
               "test5": 0.9030892260006065
            },
            {
               "test4": 2.5839645256524575,
               "test5": 0.24675336108289814
            },
            {
               "test4": 0.10160702126837584,
               "test5": 0.5960475349555014
            },
            {
               "test4": 1.2623845337724788,
               "test5": 2.1208351549341105
            },
            {
               "test4": 0.7738324522952847,
               "test5": 2.2146695174494164
            },
            {
               "test4": 2.129754703558975,
               "test5": 0.010551570723648651
            },
            {
               "test4": 2.0901463193063363,
               "test5": 2.850500494964634
            },
            {
               "test4": 2.3572450509935057,
               "test5": 0.908753779591445
            },
            {
               "test4": 1.570899641481327,
               "test5": 1.7727628948981726
            },
            {
               "test4": 2.0899569228819006,
               "test5": 1.41859770205485
            },
            {
               "test4": 2.5981884538820594,
               "test5": 0.38938511569839285
            },
            {
               "test4": 2.419497059144466,
               "test5": 0.8122703557929933
            },
            {
               "test4": 0.23816951225337846,
               "test5": 1.591537530030845
            },
            {
               "test4": 0.1325402923764134,
               "test5": 0.6424901634404623
            },
            {
               "test4": 2.3588918178284057,
               "test5": 0.8344843565656651
            },
            {
               "test4": 2.018556822524736,
               "test5": 2.537536451246244
            },
            {
               "test4": 2.405376081861653,
               "test5": 2.5590320177525037
            },
            {
               "test4": 2.320762136425079,
               "test5": 2.917847671992752
            },
            {
               "test4": 2.570504242847896,
               "test5": 2.2237174648974296
            },
            {
               "test4": 1.7967416261256348,
               "test5": 2.1537028757519483
            },
            {
               "test4": 1.8632915151426386,
               "test5": 2.7791116894687353
            },
            {
               "test4": 1.2707190243284359,
               "test5": 0.4612085716272455
            },
            {
               "test4": 0.7048473216887272,
               "test5": 2.6508629047528727
            },
            {
               "test4": 0.5315304121131016,
               "test5": 0.9432685536104027
            },
            {
               "test4": 2.338884337368572,
               "test5": 1.013957124589142
            },
            {
               "test4": 0.5766990964329476,
               "test5": 2.757904587079511
            },
            {
               "test4": 0.8723013003727706,
               "test5": 1.4186786159533566
            },
            {
               "test4": 2.2529711433765325,
               "test5": 0.447306735860983
            },
            {
               "test4": 1.7449170492885626,
               "test5": 2.464120844148174
            },
            {
               "test4": 1.9638188933210374,
               "test5": 2.980857932269373
            }
         ]
      },
      {
         "name": "heatmap_bins",
         "source": "points",
         "transform": [
            {
               "type": "extent",
               "field": {
                  "signal": "x_name"
               },
               "signal": "x_extent"
            },
            {
               "type": "bin",
               "field": {
                  "signal": "x_name"
               },
               "as": [
                  "x_start",
                  "x_end"
               ],
               "signal": "x_bins",
               "extent": {
                  "signal": "x_extent"
               },
               "maxbins": {
                  "signal": "max_x_bins"
               }
            },
            {
               "type": "extent",
               "field": {
                  "signal": "y_name"
               },
               "signal": "y_extent"
            },
            {
               "type": "bin",
               "field": {
                  "signal": "y_name"
               },
               "as": [
                  "y_start",
                  "y_end"
               ],
               "signal": "y_bins",
               "extent": {
                  "signal": "y_extent"
               },
               "maxbins": {
                  "signal": "max_y_bins"
               }
            },
            {
               "type": "aggregate",
               "groupby": [
                  "x_start",
                  "x_end",
                  "y_start",
                  "y_end"
               ],
               "ops": [
                  "count"
               ],
               "as": [
                  "__count"
               ]
            }
         ]
      }
   ],
   "marks": [
      {
         "name": "marks",
         "type": "rect",
         "style": [
            "rect"
         ],
         "from": {
            "data": "heatmap_bins"
         },
         "encode": {
            "update": {
               "fill": {
                  "scale": "color",
                  "field": "__count"
               },
               "x2": {
                  "scale": "x",
                  "field": "x_start"
               },
               "x": {
                  "scale": "x",
                  "field": "x_end"
               },
               "y2": {
                  "scale": "y",
                  "field": "y_start"
               },
               "y": {
                  "scale": "y",
                  "field": "y_end"
               }
            }
         }
      },
      {
         "type": "symbol",
         "from": {
            "data": "points"
         },
         "encode": {
            "enter": {
               "fillOpacity": {
                  "value": 1
               },
               "fill": {
                  "value": "black"
               }
            },
            "update": {
               "x": {
                  "scale": "x",
                  "field": {
                     "signal": "x_name"
                  }
               },
               "y": {
                  "scale": "y",
                  "field": {
                     "signal": "y_name"
                  }
               },
               "size": {
                  "value": 10
               }
            }
         }
      }
   ],
   "scales": [
      {
         "name": "x",
         "type": "linear",
         "domain": {
            "signal": "[x_bins.start, x_bins.stop]"
         },
         "range": [
            0,
            {
               "signal": "width"
            }
         ],
         "bins": {
            "signal": "x_bins"
         },
         "zero": false
      },
      {
         "name": "y",
         "type": "linear",
         "domain": {
            "signal": "[y_bins.start, y_bins.stop]"
         },
         "range": [
            {
               "signal": "height"
            },
            0
         ],
         "bins": {
            "signal": "y_bins"
         },
         "zero": false
      },
      {
         "name": "color",
         "type": "linear",
         "domain": {
            "data": "heatmap_bins",
            "field": "__count"
         },
         "range": "heatmap",
         "interpolate": "hcl",
         "zero": true
      }
   ],
   "axes": [
      {
         "scale": "x",
         "orient": "bottom",
         "title": {
            "signal": "x_name"
         },
         "labelOverlap": true,
         "tickCount": {
            "signal": "ceil(width/3)"
         }
      },
      {
         "scale": "y",
         "orient": "left",
         "title": {
            "signal": "y_name"
         },
         "labelOverlap": true,
         "tickCount": {
            "signal": "ceil(height/3)"
         }
      }
   ],
   "legends": [
      {
         "fill": "color",
         "gradientLength": {
            "signal": "height - 16"
         },
         "title": "Count of Records"
      }
   ]
}