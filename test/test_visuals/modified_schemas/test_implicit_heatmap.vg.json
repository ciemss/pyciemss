{
   "$schema": "https://vega.github.io/schema/vega/v5.json",
   "width": 300,
   "height": 200,
   "signals": [
      {
         "name": "max_x_bins",
         "value": 4,
         "description": "Max number X bins",
         "bind": {
            "input": "range",
            "min": 1,
            "max": 100,
            "step": 1
         }
      },
      {
         "name": "max_y_bins",
         "value": 4,
         "description": "Max number Y bins",
         "bind": {
            "input": "range",
            "min": 1,
            "max": 100,
            "step": 1
         }
      },
      {
         "name": "x_name",
         "value": "test4"
      },
      {
         "name": "y_name",
         "value": "test5"
      }
   ],
   "data": [
      {
         "name": "points",
         "values": [
            {
               "test4": 0.8268055541820771,
               "test5": 1.6596793015440414
            },
            {
               "test4": 2.004406051957159,
               "test5": 0.5497427123293225
            },
            {
               "test4": 1.018597001592099,
               "test5": 1.502161723178585
            },
            {
               "test4": 0.18053457159967412,
               "test5": 1.2903236717408504
            },
            {
               "test4": 0.68922428396612,
               "test5": 0.5623871147084529
            },
            {
               "test4": 0.761489583463082,
               "test5": 2.3581397895655636
            },
            {
               "test4": 1.3439331764418383,
               "test5": 0.7136298601773857
            },
            {
               "test4": 1.9524937149096848,
               "test5": 0.5228400581773959
            },
            {
               "test4": 0.06239427510786244,
               "test5": 2.110867361831164
            },
            {
               "test4": 0.8175719471197874,
               "test5": 1.8843427712906655
            },
            {
               "test4": 2.0055212953823034,
               "test5": 1.4277636986087048
            },
            {
               "test4": 0.6728791925277353,
               "test5": 1.495408337900394
            },
            {
               "test4": 1.1603605720901902,
               "test5": 0.4842759516342452
            },
            {
               "test4": 1.8165879204543387,
               "test5": 1.8394588486395327
            },
            {
               "test4": 0.13185631260955655,
               "test5": 1.6496170192013644
            },
            {
               "test4": 1.165232816493838,
               "test5": 1.224423168487729
            },
            {
               "test4": 0.4214189672558758,
               "test5": 0.12432936941776074
            },
            {
               "test4": 2.8147960162112278,
               "test5": 2.9465426485569823
            },
            {
               "test4": 2.903339234521064,
               "test5": 1.853853579799692
            },
            {
               "test4": 0.20349375349209098,
               "test5": 0.5538061302005705
            },
            {
               "test4": 2.905953414098736,
               "test5": 2.910871105039571
            },
            {
               "test4": 2.6283583983935133,
               "test5": 0.80579124072148
            },
            {
               "test4": 1.8968159557430049,
               "test5": 0.4535652294562298
            },
            {
               "test4": 2.055674607405782,
               "test5": 1.3308212492418066
            },
            {
               "test4": 0.3701918802643237,
               "test5": 1.8401383403557041
            },
            {
               "test4": 0.6156837256483622,
               "test5": 0.5572208197078303
            },
            {
               "test4": 0.667454469913216,
               "test5": 1.0058965922205454
            },
            {
               "test4": 0.5600982792903815,
               "test5": 0.4758329596878189
            },
            {
               "test4": 1.5973138187462732,
               "test5": 0.058758663196358474
            },
            {
               "test4": 0.6683019235011843,
               "test5": 0.7696116727763983
            },
            {
               "test4": 2.7977989353593924,
               "test5": 2.6405162148773416
            },
            {
               "test4": 1.4657801070337517,
               "test5": 2.10249039565525
            },
            {
               "test4": 1.7960379744468362,
               "test5": 2.7811034823100895
            },
            {
               "test4": 0.0929495857273509,
               "test5": 2.1139927684319364
            },
            {
               "test4": 2.649261498504233,
               "test5": 2.316759629263249
            },
            {
               "test4": 2.522478085590926,
               "test5": 0.7858295252290733
            },
            {
               "test4": 1.6774131516528872,
               "test5": 1.9464050891587246
            },
            {
               "test4": 2.676640867322459,
               "test5": 0.7846735341422658
            },
            {
               "test4": 2.833935804569547,
               "test5": 0.8138579986098294
            },
            {
               "test4": 0.3699332426198837,
               "test5": 1.365448935388668
            },
            {
               "test4": 0.6113854778931382,
               "test5": 2.006647650711507
            },
            {
               "test4": 0.5498283494851601,
               "test5": 2.919183012107779
            },
            {
               "test4": 2.1554709723327807,
               "test5": 2.5648370640712685
            },
            {
               "test4": 2.0421039815557847,
               "test5": 0.7865084775775296
            },
            {
               "test4": 2.9086236738106748,
               "test5": 0.9625465521424954
            },
            {
               "test4": 0.8412286551429411,
               "test5": 1.29495730498757
            },
            {
               "test4": 1.506803598793958,
               "test5": 1.9032032478063907
            },
            {
               "test4": 2.5357658211148553,
               "test5": 2.547428241606831
            },
            {
               "test4": 1.5139951626100445,
               "test5": 1.5481860368562037
            },
            {
               "test4": 2.9723997391131016,
               "test5": 0.022682432711872313
            },
            {
               "test4": 1.428893432601972,
               "test5": 2.599505431834342
            },
            {
               "test4": 0.7018430771386285,
               "test5": 1.3415084462321283
            },
            {
               "test4": 1.3169091022530601,
               "test5": 1.9644062535903046
            },
            {
               "test4": 1.6397502379736282,
               "test5": 2.082443816949893
            },
            {
               "test4": 0.9821086228852502,
               "test5": 0.5126706651577382
            },
            {
               "test4": 0.6047639940715692,
               "test5": 1.4175649906904078
            },
            {
               "test4": 2.1790824646942752,
               "test5": 1.6647789475620267
            },
            {
               "test4": 2.5701913303079227,
               "test5": 2.827506965474377
            },
            {
               "test4": 2.642849391273554,
               "test5": 0.7150923616376699
            },
            {
               "test4": 2.6771405416843606,
               "test5": 0.44969154001236633
            },
            {
               "test4": 1.3425570702287009,
               "test5": 1.9740570612068273
            },
            {
               "test4": 0.21187436602322007,
               "test5": 0.02898686335881895
            },
            {
               "test4": 2.3352899328237244,
               "test5": 0.5244987171824913
            },
            {
               "test4": 2.9325845529469823,
               "test5": 0.3616294962686417
            },
            {
               "test4": 2.1850527684022865,
               "test5": 1.176523555676663
            },
            {
               "test4": 2.8907561131823267,
               "test5": 2.429489929576769
            },
            {
               "test4": 1.5070869982648918,
               "test5": 2.8610978973161165
            },
            {
               "test4": 1.4844803542104545,
               "test5": 1.2757800999628275
            },
            {
               "test4": 1.5129661337294034,
               "test5": 2.105536867643983
            },
            {
               "test4": 1.7778756337760349,
               "test5": 2.134772700040699
            },
            {
               "test4": 0.8151517253214915,
               "test5": 1.5524547488294076
            },
            {
               "test4": 1.7989304251322356,
               "test5": 1.4917893611370083
            },
            {
               "test4": 1.1080663164760387,
               "test5": 2.0509841641240802
            },
            {
               "test4": 1.7470495604105136,
               "test5": 2.952583098263545
            },
            {
               "test4": 1.6239953174363528,
               "test5": 1.509826646656156
            },
            {
               "test4": 2.2890962911846877,
               "test5": 0.6647179938903881
            },
            {
               "test4": 2.7135828453330775,
               "test5": 2.1986450865835145
            },
            {
               "test4": 2.2581048563732278,
               "test5": 2.836682286858551
            },
            {
               "test4": 1.4108178149803907,
               "test5": 0.5683006002361425
            },
            {
               "test4": 0.5937809265809064,
               "test5": 1.7906780392915551
            },
            {
               "test4": 1.7174777036103652,
               "test5": 2.271287791020951
            },
            {
               "test4": 0.32244770319850213,
               "test5": 0.10409865983416056
            },
            {
               "test4": 2.8677731444518364,
               "test5": 2.0488785819342428
            },
            {
               "test4": 0.29367851488225905,
               "test5": 1.0418396111327644
            },
            {
               "test4": 2.20212376465011,
               "test5": 1.7703708286195776
            },
            {
               "test4": 0.13962648011860945,
               "test5": 1.7774643729472894
            },
            {
               "test4": 1.6012907070743894,
               "test5": 2.267286105343221
            },
            {
               "test4": 2.112402784533378,
               "test5": 1.6158968263573819
            },
            {
               "test4": 1.215864997152032,
               "test5": 0.018352811525847446
            },
            {
               "test4": 0.28035267508351647,
               "test5": 2.849564985263756
            },
            {
               "test4": 0.1340174336770925,
               "test5": 2.5264371946608954
            },
            {
               "test4": 0.3076654377444572,
               "test5": 0.25861582109003023
            },
            {
               "test4": 0.5641730792700586,
               "test5": 1.482158146796946
            },
            {
               "test4": 0.7636413092670092,
               "test5": 1.2810285354949011
            },
            {
               "test4": 1.8540454968630184,
               "test5": 0.04999293437681995
            },
            {
               "test4": 1.2912947541874347,
               "test5": 1.9780980797585244
            },
            {
               "test4": 2.6406241718793164,
               "test5": 2.72971717754457
            },
            {
               "test4": 0.5396634725986152,
               "test5": 0.0964686178483527
            },
            {
               "test4": 0.05516642852485243,
               "test5": 1.2469804183261561
            },
            {
               "test4": 2.3403797355166587,
               "test5": 0.3674516388397834
            }
         ]
      },
      {
         "name": "heatmap_bins",
         "source": "points",
         "transform": [
            {
               "type": "extent",
               "field": {
                  "signal": "x_name"
               },
               "signal": "x_extent"
            },
            {
               "type": "bin",
               "field": {
                  "signal": "x_name"
               },
               "as": [
                  "x_start",
                  "x_end"
               ],
               "signal": "x_bins",
               "extent": {
                  "signal": "x_extent"
               },
               "maxbins": {
                  "signal": "max_x_bins"
               }
            },
            {
               "type": "extent",
               "field": {
                  "signal": "y_name"
               },
               "signal": "y_extent"
            },
            {
               "type": "bin",
               "field": {
                  "signal": "y_name"
               },
               "as": [
                  "y_start",
                  "y_end"
               ],
               "signal": "y_bins",
               "extent": {
                  "signal": "y_extent"
               },
               "maxbins": {
                  "signal": "max_y_bins"
               }
            },
            {
               "type": "aggregate",
               "groupby": [
                  "x_start",
                  "x_end",
                  "y_start",
                  "y_end"
               ],
               "ops": [
                  "count"
               ],
               "as": [
                  "__count"
               ]
            }
         ]
      }
   ],
   "marks": [
      {
         "name": "marks",
         "type": "rect",
         "style": [
            "rect"
         ],
         "from": {
            "data": "heatmap_bins"
         },
         "encode": {
            "update": {
               "fill": {
                  "scale": "color",
                  "field": "__count"
               },
               "x2": {
                  "scale": "x",
                  "field": "x_start"
               },
               "x": {
                  "scale": "x",
                  "field": "x_end"
               },
               "y2": {
                  "scale": "y",
                  "field": "y_start"
               },
               "y": {
                  "scale": "y",
                  "field": "y_end"
               }
            }
         }
      },
      {
         "type": "symbol",
         "from": {
            "data": "points"
         },
         "encode": {
            "enter": {
               "fillOpacity": {
                  "value": 1
               },
               "fill": {
                  "value": "black"
               }
            },
            "update": {
               "x": {
                  "scale": "x",
                  "field": {
                     "signal": "x_name"
                  }
               },
               "y": {
                  "scale": "y",
                  "field": {
                     "signal": "y_name"
                  }
               },
               "size": {
                  "value": 10
               }
            }
         }
      }
   ],
   "scales": [
      {
         "name": "x",
         "type": "linear",
         "domain": {
            "signal": "[x_bins.start, x_bins.stop]"
         },
         "range": [
            0,
            {
               "signal": "width"
            }
         ],
         "bins": {
            "signal": "x_bins"
         },
         "zero": false
      },
      {
         "name": "y",
         "type": "linear",
         "domain": {
            "signal": "[y_bins.start, y_bins.stop]"
         },
         "range": [
            {
               "signal": "height"
            },
            0
         ],
         "bins": {
            "signal": "y_bins"
         },
         "zero": false
      },
      {
         "name": "color",
         "type": "linear",
         "domain": {
            "data": "heatmap_bins",
            "field": "__count"
         },
         "range": "heatmap",
         "interpolate": "hcl",
         "zero": true
      }
   ],
   "axes": [
      {
         "scale": "x",
         "orient": "bottom",
         "title": {
            "signal": "x_name"
         },
         "labelOverlap": true,
         "tickCount": {
            "signal": "ceil(width/3)"
         }
      },
      {
         "scale": "y",
         "orient": "left",
         "title": {
            "signal": "y_name"
         },
         "labelOverlap": true,
         "tickCount": {
            "signal": "ceil(height/3)"
         }
      }
   ],
   "legends": [
      {
         "fill": "color",
         "gradientLength": {
            "signal": "height - 16"
         },
         "title": "Count of Records"
      }
   ]
}