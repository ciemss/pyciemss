{
  "$schema": "https://vega.github.io/schema/vega/v5.json",
  "description": "Mean Shapley Values Bar Plot with Rounded Numbers, Vertical Line at 0, and Arrow-like Bar Endpoints",
  "width": 500,
  "height": 500,
  "padding": 10,
  "data": [
    {
      "name": "table",
      "values": [
        {"variable": "Age", "Mean Shapley Value": -0.6932834614},
        {"variable": "Workclass", "Mean Shapley Value": 0.0160077181},
        {"variable": "Education-Num", "Mean Shapley Value": 0.1593687901},
        {"variable": "Marital Status", "Mean Shapley Value": -0.1227975013},
        {"variable": "Occupation", "Mean Shapley Value": -1.0234673973},
        {"variable": "Relationship", "Mean Shapley Value": -0.7476020132},
        {"variable": "Race", "Mean Shapley Value": 0.0314027765},
        {"variable": "Sex", "Mean Shapley Value": -0.7228710756},
        {"variable": "Capital Gain", "Mean Shapley Value": -0.0245469017},
        {"variable": "Capital Loss", "Mean Shapley Value": 0.0},
        {"variable": "Hours per week", "Mean Shapley Value": -0.2196676876},
        {"variable": "Country", "Mean Shapley Value": 0.0074794674}
      ],
      "transform": [
        {
          "type": "formula",
          "expr": "round(datum['Mean Shapley Value'] * 100) / 100",
          "as": "Rounded Mean Shapley Value"
        },
        {
          "type": "collect",
          "sort": {"field": "Rounded Mean Shapley Value", "order": "descending"}
        }
      ]
    }
  ],
  "scales": [
    {
      "name": "yscale",
      "type": "band",
      "domain": {"data": "table", "field": "variable"},
      "range": "height",
      "padding": 0.1
    },
    {
      "name": "xscale",
      "type": "linear",
      "domain": {"data": "table", "field": "Rounded Mean Shapley Value"},
      "range": "width",
      "padding": 0.1,
      "nice": true,
      "zero": true
    }
  ],
  "axes": [
    {"orient": "left", "scale": "yscale"},
    {"orient": "bottom", "scale": "xscale", "title": "Mean Shapley Value"}
  ],
  "marks": [
    {
      "type": "rule",
      "encode": {
        "enter": {
          "x": {"scale": "xscale", "value": 0},
          "y": {"value": 0},
          "y2": {"signal": "height"},
          "strokeWidth": {"value": 1.5},
          "stroke": {"value": "black"}
        }
      }
    },
    {
      "type": "rect",
      "from": {"data": "table"},
      "encode": {
        "enter": {
          "y": {"scale": "yscale", "field": "variable"},
          "height": {"scale": "yscale", "band": 1},
          "x": {"scale": "xscale", "field": "Rounded Mean Shapley Value"},
          "x2": {"scale": "xscale", "value": 0}
        },
        "update": {
          "fill": [
            {"test": "datum['Rounded Mean Shapley Value'] < 0", "value": "red"},
            {"test": "datum['Rounded Mean Shapley Value'] >= 0", "value": "blue"}
          ]
        },
        "hover": {
          "fill": {"value": "lightgrey"}
        }
      }
    },
    {
      "type": "text",
      "from": {"data": "table"},
      "encode": {
        "enter": {
          "y": {"scale": "yscale", "field": "variable", "band": 0.5},
          "x": {
            "scale": "xscale",
            "field": "Rounded Mean Shapley Value",
            "offset": {
              "signal": "datum['Rounded Mean Shapley Value'] >= 0 ? 10 : -10"
            }
          },
          "align": {
            "signal": "datum['Rounded Mean Shapley Value'] >= 0 ? 'left' : 'right'"
          },
          "baseline": {"value": "middle"},
          "text": {
            "signal": "datum['Rounded Mean Shapley Value'] >= 0 ? '+' + datum['Rounded Mean Shapley Value'] : datum['Rounded Mean Shapley Value']"
          },
          "fill": {"value": "grey"}
        }
      }
    }
  ]
}
