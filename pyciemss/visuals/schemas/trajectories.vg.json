{
  "$schema": "https://vega.github.io/schema/vega/v5.json",
  "width": 500,
  "height": 300,
  "scales": [
    {
      "name": "xscale",
      "type": "linear",
      "range": "width",
      "zero": false,
      "domain": {
        "fields": [
          {
            "data": "distributions",
            "field": "timepoint"
          },
          {
            "data": "traces",
            "field": "timepoint"
          },
          {
            "data": "points",
            "field": "timepoint"
          }
        ]
      }
    },
    {
      "name": "yscale",
      "type": "linear",
      "range": "height",
      "nice": true,
      "zero": true,
      "domain": {
        "fields": [
          {
            "data": "distributions",
            "field": "lower"
          },
          {
            "data": "distributions",
            "field": "upper"
          },
          {
            "data": "traces",
            "field": "value"
          },
          {
            "data": "points",
            "field": "value"
          }
        ]
      }
    },
    {
      "name": "markerscale_v",
      "type": "ordinal",
      "domain": {
        "data": "markers_v",
        "field": "label"
      },
      "range": {
        "data": "markers_v",
        "field": "new_color"
      }
    },
    {
      "name": "markerscale_h",
      "type": "ordinal",
      "domain": {
        "data": "markers_h",
        "field": "label"
      },
      "range": {
        "data": "markers_h",
        "field": "new_color"
      }
    },
    {
      "name": "fillScale",
      "type": "ordinal",
      "domain": [
        "Susceptible_State",
        "Infected_State",
        "Exposed_State",
        "Resistant_State"
      ],
      "range": [
        "purple",
        "url(#diagonal-stripe-2)",
        "green",
        "purple"
      ]
    },
    {
      "name": "color",
      "type": "ordinal",
      "range": [
        "purple",
        "blue",
        "green",
        "purple"
      ],
      "domain": [
        "Susceptible_State",
        "Infected_State",
        "Exposed_State",
        "Resistant_State"
      ]
    },
    {
      "name": "lineStyle_v",
      "type": "ordinal",
      "domain": {
        "data": "markers_v",
        "field": "label"
      },
      "range": {
        "data": "markers_v",
        "field": "type"
      }},
    {
      "name": "lineStyle_h",
      "type": "ordinal",
      "domain": {
        "data": "markers_h",
        "field": "label"
      },
      "range": {
        "data": "markers_h",
        "field": "type"
      }
    },
    {
      "name": "trajectoryOrder",
      "type": "ordinal",
      "domain": [
        "Susceptible_State",
        "Infected_State",
        "Exposed_State",
        "Resistant_State"
      ],
      "range": [
        0,
        1,
        2,
        3
      ]
    }
  ],
  "axes": [
    {
      "orient": "bottom",
      "scale": "xscale",
      "zindex": 100,
      "title": {
        "signal": "data('axis_labels')[0].xaxis_label"
      }
    },
    {
      "orient": "left",
      "scale": "yscale",
      "zindex": 100,
      "title": {
        "signal": "data('axis_labels')[0].yaxis_label"
      }
    }
  ],
  "signals": [
    {
      "name": "clear",
      "value": true,
      "on": [
        {
          "events": "mouseup[!event.item]",
          "update": "true",
          "force": true
        }
      ]
    },
    {
      "name": "shift",
      "value": false,
      "on": [
        {
          "events": "@legendSymbol:click, @legendLabel:click",
          "update": "event.shiftKey",
          "force": true
        }
      ]
    },
    {
      "name": "clicked",
      "value": null,
      "on": [
        {
          "events": "@legendSymbol:click, @legendLabel:click",
          "update": "{value: datum.value}",
          "force": true
        }
      ]
    },
    {
      "name": "clearData",
      "value": true,
      "on": [
        {
          "events": "mouseup[!event.item]",
          "update": "true",
          "force": true
        }
      ]
    },
    {
      "name": "clickedData",
      "value": null,
      "on": [
        {
          "events": "@area:click",
          "update": "{value: datum.trajectory}",
          "force": true
        }
      ]
    },
    {
      "name": "logLegendClick",
      "value": null,
      "on": [
        {
          "events": "@legendSymbol:click, @legendLabel:click",
          "update": "{datum: datum}",
          "force": true
        }
      ]
    },
    {
      "description": "Active datapoint",
      "name": "activated_datapoint",
      "value": null,
      "on": [
        {
          "events": "symbol:mouseover",
          "update": "item()"
        },
        {
          "events": "symbol:mouseout",
          "update": "null"
        }
      ]
    },
    {
      "name": "logAreaClick",
      "value": null,
      "on": [
        {
          "events": "@area:click",
          "update": "{datum: datum}",
          "force": true
        }
      ]
    }
  ],
  "config": {
    "logLevel": "warn"
  },
  "legends": [
      {
        "name": "color_legend",
        "fill": "fillScale",
        "stroke": "color",
        "title": "Trajectory States",
        "type": "symbol",
        "symbolType": "square",
        "symbolSize": 200,
        "encode": {
          "symbols": {
            "enter": {
              "shape": {"value": "square"},
              "size": {"value": 200},
              "fill": {"scale": "fillScale", "field": "trajectory"},
              "stroke": {"scale": "color", "field": "trajectory"},
              "strokeWidth": {"value": 2}
            },
            "update": {
              "opacity": [
                {"test": "!length(data('selected')) || indata('selected', 'value', datum.trajectory) || indata('selectedData', 'value', datum.trajectory)", "value": 0.7},
                {"value": 0.15}
              ]
            }
          },
          "labels": {
            "update": {
              "opacity": [
                {"test": "!length(data('selectedData')) || indata('selectedData', 'value', datum.trajectory)", "value": 1},
                {"value": 0.25}
              ]
            }
          }
        }
      },
      {
        "name": "marker_color_legend_v",
        "stroke": "markerscale_v",
        "strokeDash": "lineStyle_v",
        "title": {"signal": "length(data('markers_v')) > 1 ? 'Vertical Markers' : ''"},
        "interactive": true,
        "encode": {
          "symbols": {
            "enter": {
            "shape": {"value": "square"},
            "stroke": {"scale": "markerscale_v", "field": "label"},
              "strokeDash": {
                "scale": "lineStyle_v",
                "field": "type"
              },
            "strokeWidth": {"value": 1},
              "size": {"value": 200},
            "opacity": {"value": 1}
            },
            "update": {
              "opacity": [
                {"test": "length(data('markers_v')) > 1", "value": 1},
                {"value": 0}
              ]
            }
          },
          "labels": {
            "update": {
              "text": {"field": "label"},
              "fill": {"value": "black"},
              "opacity": [
                {"test": "length(data('markers_v')) > 1", "value": 1},
                {"value": 0}
              ]
            }
          }
        }
      },
      {
        "name": "marker_color_legend_h",
        "stroke": "markerscale_h",
        "strokeDash": "lineStyle_h",
        "title": {"signal": "length(data('markers_h')) > 1 ? 'Horizontal Markers' : ''"},
        "interactive": true,
        "encode": {
          "symbols": {
            "enter": {
            "shape": {"value": "square"},
            "stroke": {"scale": "markerscale_v", "field": "label"},
              "strokeDash": {
                "scale": "lineStyle_h",
                "field": "type"
              },
            "strokeWidth": {"value": 1},
              "size": {"value": 200},
            "opacity": {"value": 1}
            },
            "update": {
              "opacity": [
                {"test": "length(data('markers_h')) > 1", "value": 1},
                {"value": 0}
              ]
            }
          },
          "labels": {
            "update": {
              "text": {"field": "label"},
              "fill": {"value": "black"},
              "opacity": [
                {"test": "length(data('markers_h')) > 1", "value": 1},
                {"value": 0}
              ]
            }
          }
        }
      }
],
  "marks": [
    {
      "type": "group",
      "zindex": 3,
      "name": "_points",
      "from": {
        "facet": {
          "name": "points_split",
          "data": "points",
          "groupby": "trajectory"
        }
      },
      "marks": [
        {
          "type": "symbol",
          "name": "_points_symbol",
          "from": {
            "data": "points_split"
          },
          "zindex": 3,
          "encode": {
            "update": {
              "x": {
                "scale": "xscale",
                "field": "timepoint"
              },
              "y": {
                "scale": "yscale",
                "field": "value"
              },
              "size": {
                "value": 35
              },
              "strokeWidth": {
                "value": 2
              },
              "stroke": {
                "scale": "color",
                "field": "trajectory"
              },
              "fillOpacity": [
                {
                  "test": "!length(data('selected')) || indata('selected', 'value', datum.trajectory)",
                  "value": 0.5
                },
                {
                  "value": 0.15
                }
              ],
              "strokeOpacity": [
                {
                  "test": "!length(data('selected')) || indata('selected', 'value', datum.trajectory)",
                  "value": 0.75
                },
                {
                  "value": 0.15
                }
              ],
              "tooltip": {
                "field": "value"
              }
            },
            "hover": {
              "fillOpacity": {
                "value": 0.9
              }
            }
          }
        },
        {
          "type": "line",
          "name": "_points_line",
          "from": {
            "data": "points_split"
          },
          "zindex": 3,
          "encode": {
            "update": {
              "x": {
                "scale": "xscale",
                "field": "timepoint"
              },
              "y": {
                "scale": "yscale",
                "field": "value"
              },
              "strokeWidth": {
                "value": 2
              },
              "stroke": {
                "scale": "color",
                "field": "trajectory"
              },
              "interpolate": {
                "value": "linear"
              },
              "strokeDash": {
                "value": [
                  5,
                  3
                ]
              },
              "strokeOpacity": [
                {
                  "test": "!length(data('selected')) || indata('selected', 'value', datum.trajectory)",
                  "value": 0.3
                },
                {
                  "value": 0.1
                }
              ]
            },
            "hover": {
              "fillOpacity": {
                "value": 0.9
              }
            }
          }
        }
      ]
    },
    {
      "type": "group",
      "zindex": 2,
      "name": "_traces",
      "from": {
        "facet": {
          "name": "traces_split",
          "data": "traces",
          "groupby": "trajectory"
        }
      },
      "marks": [
        {
          "type": "line",
          "name": "_traces_lines",
          "from": {
            "data": "traces_split"
          },
          "encode": {
            "update": {
              "x": {
                "scale": "xscale",
                "field": "timepoint"
              },
              "y": {
                "scale": "yscale",
                "field": "value"
              },
              "strokeWidth": {
                "value": 2
              },
              "stroke": {
                "scale": "color",
                "field": "trajectory"
              },
              "interpolate": {
                "value": "linear"
              },
              "strokeOpacity": [
                {
                  "test": "!length(data('selected')) || indata('selected', 'value', datum.trajectory)",
                  "value": 0.75
                },
                {
                  "value": 0.15
                }
              ]
            },
            "hover": {
              "fillOpacity": {
                "value": 0.9
              }
            }
          }
        }
      ]
    },
    {
      "type": "group",
      "name": "_distributions",
      "zindex": 1,
      "from": {
        "facet": {
          "name": "trajectory_split",
          "data": "distributions",
          "groupby": "trajectory_order"
        }
      },
      "sort": {
        "field": "datum.trajectory_order",
        "order": "ascending"
      },
      "marks": [
        {
          "type": "area",
          "name": "area",
          "interactive": true,
          "from": {
            "data": "trajectory_split"
          },
          "encode": {
            "update": {
              "x": {
                "scale": "xscale",
                "field": "timepoint"
              },
              "y": {
                "scale": "yscale",
                "field": "upper"
              },
              "y2": {
                "scale": "yscale",
                "field": "lower"
              },
              "interpolate": {
                "value": "linear"
              },
              "strokeWidth": {
                "value": 2
              },
              "fill": {
                "scale": "fillScale",
                "field": "trajectory"
              },
              "stroke": {
                "scale": "color",
                "field": "trajectory"
              },
              "fillOpacity": [
                {
                  "test": "!length(data('selected')) || indata('selected', 'value', datum.trajectory)",
                  "value": 0.5
                },
                {
                  "value": 0.15
                }
              ],
              "strokeOpacity": [
                {
                  "test": "!length(data('selected')) || indata('selected', 'value', datum.trajectory)",
                  "value": 0.75
                },
                {
                  "value": 0.15
                }
              ]
            },
            "hover": {
              "fillOpacity": {
                "value": 0.9
              }
            }
          }
        }
      ]
    },
    {
      "type": "group",
      "name": "_markers_v",
      "marks": [
        {
          "type": "rule",
          "name": "_marker_v text",
          "from": {
            "data": "markers_v"
          },
          "encode": {
            "enter": {
              "stroke": {
                "scale": "markerscale_v",
                "field": "label"
              },
              "strokeDash": {
                "scale": "lineStyle_v",
                "field": "label"
              }
            },
            "update": {
              "x": {
                "scale": "xscale",
                "field": "axis_value"
              },
              "y2": {
                "value": 0
              },
              "y": {
                "signal": "height"
              },
              "opacity": {
                "value": 1
              }
            }
          }
        }
      ]
    },
    {
      "type": "group",
      "name": "_markers_h",
      "marks": [
        {
          "type": "rule",
          "name": "_marker_h text",
          "from": {
            "data": "markers_h"
          },
          "encode": {
            "enter": {
              "stroke": {
                "scale": "markerscale_h",
                "field": "label"
              },
              "strokeDash": {
                "scale": "lineStyle_h",
                "field": "label"
              }
            },
            "update": {
              "y": {
                "scale": "yscale",
                "field": "axis_value"
              },
              "x2": {
                "value": 0
              },
              "x": {
                "signal": "width"
              },
              "opacity": {
                "value": 1
              }
            }
          }
        }
      ]
    }
  ],
  "data": [
    
{
  "name": "distributions",
  "values": [
    {"trajectory": "Susceptible_State", "timepoint": 1, "lower": 1, "upper": 5},
    {"trajectory": "Susceptible_State", "timepoint": 2, "lower": 2, "upper": 6},
    {"trajectory": "Susceptible_State", "timepoint": 3, "lower": 2.5, "upper": 6.5},
    {"trajectory": "Susceptible_State", "timepoint": 4, "lower": 3, "upper": 7},
    {"trajectory": "Susceptible_State", "timepoint": 5, "lower": 4, "upper": 8},
    {"trajectory": "Exposed_State", "timepoint": 1, "lower": 4, "upper": 8},
    {"trajectory": "Exposed_State", "timepoint": 2, "lower": 4.5, "upper": 8.5},
    {"trajectory": "Exposed_State", "timepoint": 3, "lower": 5, "upper": 9},
    {"trajectory": "Exposed_State", "timepoint": 4, "lower": 5.5, "upper": 9.5},
    {"trajectory": "Exposed_State", "timepoint": 5, "lower": 6, "upper": 10}
  ],
      "transform": [
        {
          "type": "collect",
          "sort": {
            "field": [
              "trajectory",
              "timepoint"
            ]
          }
        },
        {
          "type": "formula",
          "expr": "scale('trajectoryOrder', datum.trajectory)",
          "as": "trajectory_order"
        }
      ]
    },
    {
      "name": "traces",
      "values": [],
      "transform": [
        {
          "type": "filter",
          "expr": "isValid(datum.value)"
        },
        {
          "type": "collect",
          "sort": {
            "field": [
              "trajectory",
              "timepoint"
            ]
          }
        }
      ]
    },
    {
      "name": "points",
      "values": []
    },
    {
      "name": "markers_v",
      "values": [
        {
          "axis_value": 3,
          "label": "Low marker",
          "new_color": "red",
          "type": [4,5]
        },
        {
          "axis_value": 7,
          "label": "High marker",
          "new_color": "blue",
          "type": [4,5]
        }
      ]
    },
    {
      "name": "markers_h",
      "values": [
        {
          "axis_value": 3,
          "label": "Low marker",
          "new_color": "red",
          "type": [1,5]
        },
        {
          "axis_value": 7,
          "label": "High marker",
          "new_color": "purple",
          "type": [1,0]
        }
      ]
    },
    {
      "name": "axis_labels",
      "values": {
        "xaxis_label": "Time (days)",
        "yaxis_label": "Population"
      }
    },
    {
      "name": "selected",
      "on": [
        {
          "trigger": "clear",
          "remove": true
        },
        {
          "trigger": "!shift",
          "remove": true
        },
        {
          "trigger": "!shift && clicked",
          "insert": "clicked"
        },
        {
          "trigger": "shift && clicked",
          "toggle": "clicked"
        }
      ]
    },
    {
      "name": "selectedData",
      "on": [
        {
          "trigger": "clearData",
          "remove": true
        },
        {
          "trigger": "clickedData",
          "toggle": "clickedData"
        }
      ]
    }
  ],
  "title": "Customized Trajectories Plot"
}
